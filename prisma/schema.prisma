// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("PRISMA_DATABASE_URL")
}

// CONVENTION:
//   use snake_case for fields and tables (model names should be PascalCase), it works better with
//   postgresql

model User {
  username String @id
  password String // bcrypt-hashed ofc

  subjects  Subject[]
  materials Material[]

  sessions StudySession[]

  @@map("user")
}

model Subject {
  id    Int    @id @default(autoincrement())
  title String

  owner          User   @relation(fields: [owner_username], references: [username], onDelete: Cascade)
  owner_username String

  materials Material[]

  @@map("subject")
}

model Material {
  id    Int    @id @default(autoincrement())
  title String

  parent_subject Subject @relation(fields: [subject_id], references: [id], onDelete: Cascade)
  subject_id     Int

  owner          User   @relation(fields: [owner_username], references: [username], onDelete: Cascade)
  owner_username String

  study_sessions StudySession[]

  @@map("material")
}

model StudySession {
  id    Int      @id @default(autoincrement())
  start DateTime @default(now())

  user     User   @relation(fields: [username], references: [username], onDelete: Cascade)
  username String

  material    Material @relation(fields: [material_id], references: [id], onDelete: Cascade)
  material_id Int

  before_score Int

  conclusion StudySessionConclusion? // if null, then the study session is still on going

  @@map("study_session")
}

model StudySessionConclusion {
  id     Int          @id @default(autoincrement())
  parent StudySession @relation(fields: [study_session_id], references: [id], onDelete: Cascade)

  study_session_id Int      @unique
  end              DateTime @default(now())

  study_time Int
  break_time Int

  after_score Int

  @@map("study_session_conclusion")
}
